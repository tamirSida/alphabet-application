<div class="dashboard-container">
  @if (isLoading()) {
    <div class="loading">
      <i class="fas fa-spinner fa-spin"></i>
      <p>Loading dashboard...</p>
    </div>
  } @else {
    <header class="dashboard-header">
      <div class="header-top">
        <div class="logo-section">
          <img src="/images/logo.png" alt="Alpha-Bet Logo" class="logo">
        </div>
      </div>
      <div class="header-content">
        <div class="user-info">
          <h1>Welcome back</h1>
          <p>{{ user()?.email }}</p>
          <div class="operator-id">
            <i class="fas fa-id-card"></i>
            Operator ID: <strong>{{ user()?.operatorId }}</strong>
          </div>
        </div>
        <button class="sign-out-button" (click)="signOut()">
          <i class="fas fa-sign-out-alt"></i>
          Sign Out
        </button>
      </div>
    </header>

    <main class="dashboard-main">
      @if (error()) {
        <div class="error-message">
          <i class="fas fa-exclamation-triangle"></i>
          <p>{{ error() }}</p>
        </div>
      } @else {
        <!-- Application Status Card -->
        <div class="status-card">
          <div class="status-header">
            <i [class]="statusDisplay().icon"></i>
            <h2>Application Status</h2>
          </div>
          <div class="status-content">
            <div class="status-badge-row">
              <div [class]="'status-badge ' + statusDisplay().class">
                {{ statusDisplay().text }}
              </div>
            </div>

            @if (user()?.status === 'not_submitted') {
              <div class="status-description">
                <p>You haven't submitted an application yet.</p>
                @if (currentAcceptingCohort()) {
                  <p><strong>Good news!</strong> Applications are currently open for {{ currentAcceptingCohort()?.number }}.</p>
                  <div class="deadline-info">
                    <div class="timezone-display">{{ formatDateInUserTimezone(currentAcceptingCohort()?.applicationEndDate) }}</div>
                  </div>

                  <div class="status-action">
                    <button class="primary-button" (click)="goToApplication()">
                      <i class="fas fa-paper-plane"></i>
                      Start Application
                    </button>
                    @if (currentAcceptingCohort()) {
                      <div class="countdown-timer">
                        <div class="countdown-label">Time to submit:</div>
                        <div class="countdown-display">
                          <span class="time-unit">{{ getTimeRemaining().days }}<small>D</small></span>
                          <span class="separator">:</span>
                          <span class="time-unit">{{ getTimeRemaining().hours }}<small>H</small></span>
                          <span class="separator">:</span>
                          <span class="time-unit">{{ getTimeRemaining().minutes }}<small>M</small></span>
                          <span class="separator">:</span>
                          <span class="time-unit">{{ getTimeRemaining().seconds }}<small>S</small></span>
                        </div>
                      </div>
                    }
                  </div>
                } @else {
                  <p>No applications are currently being accepted. Check back later for upcoming cohorts.</p>
                }
              </div>
            } @else if (user()?.status === 'submitted' || user()?.status === 'under_review') {
              <div class="status-description">
                <p>Your application has been submitted and is currently under review.
                You will receive the outcome via email once we've made a decision. We review applications on a rolling basis but you will receive a final answer no later than {{ getReviewDeadline() }}.</p>
                @if (application()) {
                  <p><strong>Submitted:</strong> {{ application()?.submittedAt | date:'fullDate' }}</p>
                  <p><strong>Class:</strong> {{ cohort()?.number }}</p>
                }
              </div>
            } @else if (user()?.status === 'accepted') {
              <div class="status-description">
                <div class="status-message" [innerHTML]="acceptedMessage()"></div>
              </div>
            } @else if (user()?.status === 'rejected') {
              <div class="status-description">
                <div class="status-message" [innerHTML]="rejectedMessage()"></div>
              </div>
            }
          </div>
        </div>

        <!-- Action Cards -->
        <div class="action-cards">



          @if (!canApply && user()?.status === 'not_submitted') {
            <div class="action-card info-card">
              <i class="fas fa-info-circle"></i>
              <h3>No Open Applications</h3>
              <p>Applications are not currently being accepted. Please check back later.</p>
            </div>
          }
        </div>

      }
    </main>
  }
</div>
