<div class="admin-container">
  <header class="admin-header">
    <div class="header-content">
      <div class="admin-info">
        <h1>Admin Panel</h1>
        <p>{{ authService.userData()?.email }}</p>
      </div>
      <button class="sign-out-button" (click)="signOut()">
        <i class="fas fa-sign-out-alt"></i>
        Sign Out
      </button>
    </div>
  </header>

  <nav class="admin-nav">
    <button 
      class="nav-button"
      [class.active]="currentView() === 'applications'"
      (click)="switchView('applications')">
      <i class="fas fa-file-alt"></i>
      Applications
    </button>
    <button 
      class="nav-button"
      [class.active]="currentView() === 'cohorts'"
      (click)="switchView('cohorts')">
      <i class="fas fa-users"></i>
      Cohort Management
    </button>
    <button 
      class="nav-button"
      [class.active]="currentView() === 'admin'"
      (click)="switchView('admin')">
      <i class="fas fa-user-shield"></i>
      Admin Management
    </button>
  </nav>

  <main class="admin-main">
    @if (isLoading()) {
      <div class="loading">
        <i class="fas fa-spinner fa-spin"></i>
        <p>Loading...</p>
      </div>
    } @else if (error()) {
      <div class="error-message">
        <i class="fas fa-exclamation-triangle"></i>
        <p>{{ error() }}</p>
      </div>
    } @else {
      @if (currentView() === 'applications') {
        <div class="applications-view">
          <div class="view-header">
            <h2>
              <i class="fas fa-file-alt"></i>
              Applications Management
            </h2>
            <div class="stats">
              <span class="stat-item">
                Total: {{ applications().length }}
              </span>
            </div>
          </div>

          @if (applications().length === 0) {
            <div class="empty-state">
              <i class="fas fa-inbox"></i>
              <h3>No Applications Yet</h3>
              <p>Applications will appear here once users start submitting them.</p>
            </div>
          } @else {
            <div class="applications-grid">
              @for (application of applications(); track application.applicationId) {
                <div class="application-card">
                  <div class="application-header">
                    <div class="user-info">
                      <h3>{{ application.user?.email || 'Unknown User' }}</h3>
                      <p class="operator-id">
                        <i class="fas fa-id-card"></i>
                        {{ application.operatorId }}
                      </p>
                    </div>
                    <div [class]="'status-badge ' + getStatusClass(application.status)">
                      {{ application.status | titlecase }}
                    </div>
                  </div>

                  <div class="application-details">
                    <div class="detail-item">
                      <strong>Cohort:</strong> {{ application.cohort?.number || 'Unknown' }}
                    </div>
                    <div class="detail-item">
                      <strong>Submitted:</strong> {{ application.submittedAt | date:'short' }}
                    </div>
                    @if (application.reviewedAt) {
                      <div class="detail-item">
                        <strong>Reviewed:</strong> {{ application.reviewedAt | date:'short' }}
                      </div>
                    }
                  </div>

                  <div class="application-actions">
                    @if (application.status === 'submitted' || application.status === 'under_review') {
                      <button 
                        class="action-button accept-button"
                        (click)="updateApplicationStatus(application.applicationId, 'accepted')">
                        <i class="fas fa-check"></i>
                        Accept
                      </button>
                      <button 
                        class="action-button reject-button"
                        (click)="updateApplicationStatus(application.applicationId, 'rejected')">
                        <i class="fas fa-times"></i>
                        Reject
                      </button>
                    } @else {
                      <button class="action-button view-button" disabled>
                        <i class="fas fa-eye"></i>
                        View Details
                      </button>
                    }
                  </div>
                </div>
              }
            </div>
          }
        </div>
      } @else if (currentView() === 'cohorts') {
        <div class="cohorts-view">
          <div class="view-header">
            <h2>
              <i class="fas fa-users"></i>
              Cohort Management
            </h2>
            <button class="primary-button" (click)="toggleCohortForm()">
              <i class="fas fa-plus"></i>
              Create Cohort
            </button>
          </div>

          @if (success()) {
            <div class="alert alert-success">
              <i class="fas fa-check-circle"></i>
              {{ success() }}
            </div>
          }

          @if (showCohortForm()) {
            <div class="form-container">
              <form [formGroup]="cohortForm" (ngSubmit)="createCohort()" class="create-form">
                <h3>{{ editingCohort() ? 'Edit Cohort' : 'Create New Cohort' }}</h3>
                
                <div class="form-group">
                  <label for="cohort-number">Cohort Number</label>
                  <input
                    type="text"
                    id="cohort-number"
                    formControlName="number"
                    placeholder="e.g., Cohort 1"
                    class="form-input"
                  />
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label for="app-start">Application Start Date</label>
                    <input
                      type="date"
                      id="app-start"
                      formControlName="applicationStartDate"
                      class="form-input"
                    />
                  </div>
                  <div class="form-group">
                    <label for="app-start-time">Start Time</label>
                    <input
                      type="time"
                      id="app-start-time"
                      formControlName="applicationStartTime"
                      class="form-input"
                    />
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label for="app-end">Application End Date</label>
                    <input
                      type="date"
                      id="app-end"
                      formControlName="applicationEndDate"
                      class="form-input"
                    />
                  </div>
                  <div class="form-group">
                    <label for="app-end-time">End Time</label>
                    <input
                      type="time"
                      id="app-end-time"
                      formControlName="applicationEndTime"
                      class="form-input"
                    />
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label for="cohort-start">Cohort Start Date</label>
                    <input
                      type="date"
                      id="cohort-start"
                      formControlName="cohortStartDate"
                      class="form-input"
                    />
                  </div>
                  <div class="form-group">
                    <label for="cohort-end">Cohort End Date</label>
                    <input
                      type="date"
                      id="cohort-end"
                      formControlName="cohortEndDate"
                      class="form-input"
                    />
                  </div>
                </div>

                <!-- Classes Section -->
                <div class="classes-section">
                  <div class="classes-header">
                    <h3>Classes Configuration</h3>
                    <button type="button" class="add-class-button" (click)="addNewClass()">
                      <i class="fas fa-plus"></i>
                      Add Class
                    </button>
                  </div>

                  <div formArrayName="classes" class="classes-list">
                    @for (classControl of classesArray.controls; track classIndex; let classIndex = $index) {
                      <div [formGroupName]="classIndex" class="class-item">
                        <div class="class-header">
                          <div class="class-basic-info">
                            <div class="form-group">
                              <label>Class Name</label>
                              <input
                                type="text"
                                formControlName="name"
                                class="form-input class-name-input"
                                placeholder="e.g., Class A">
                            </div>
                            <div class="form-group">
                              <label>Capacity</label>
                              <input
                                type="number"
                                formControlName="capacity"
                                class="form-input capacity-input"
                                min="1"
                                placeholder="25">
                            </div>
                          </div>
                          
                          @if (classesArray.length > 1) {
                            <button 
                              type="button" 
                              class="remove-class-button"
                              (click)="removeClass(classIndex)">
                              <i class="fas fa-trash"></i>
                            </button>
                          }
                        </div>

                        <!-- Weekdays Selection -->
                        <div class="weekdays-section">
                          <label class="section-label">Select Weekdays</label>
                          <div class="weekdays-grid" formGroupName="weekdays">
                            @for (day of ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday']; track day) {
                              <div class="weekday-item">
                                <input 
                                  type="checkbox"
                                  [id]="'weekday-' + classIndex + '-' + day"
                                  [formControlName]="day"
                                  (change)="onWeekdayChange(classIndex, day, $any($event.target).checked)">
                                <label [for]="'weekday-' + classIndex + '-' + day" class="weekday-label">
                                  {{ day.substring(0, 3) }}
                                </label>
                              </div>
                            }
                          </div>
                        </div>

                        <!-- Times for Selected Days -->
                        <div class="times-section" formGroupName="times">
                          <label class="section-label">Class Times</label>
                          <div class="times-grid">
                            @for (day of getSelectedWeekdays(classIndex); track day) {
                              <div class="time-row" [formGroupName]="day">
                                <div class="day-name">{{ day }}</div>
                                <div class="time-inputs">
                                  <input
                                    type="time"
                                    formControlName="startTime"
                                    class="form-input time-input">
                                  <span class="time-separator">to</span>
                                  <input
                                    type="time"
                                    formControlName="endTime"
                                    class="form-input time-input">
                                </div>
                              </div>
                            }
                          </div>
                          
                          @if (getSelectedWeekdays(classIndex).length === 0) {
                            <div class="no-days-selected">
                              <i class="fas fa-info-circle"></i>
                              Select weekdays above to set class times
                            </div>
                          }
                        </div>
                      </div>
                    }
                  </div>

                  @if (classesArray.length === 0) {
                    <div class="no-classes">
                      <i class="fas fa-plus-circle"></i>
                      <p>Add at least one class to continue</p>
                    </div>
                  }
                </div>

                <div class="form-actions">
                  <button type="button" class="secondary-button" (click)="toggleCohortForm()">
                    Cancel
                  </button>
                  <button type="submit" class="primary-button" [disabled]="cohortForm.invalid">
                    <i class="fas {{ editingCohort() ? 'fa-save' : 'fa-plus' }}"></i>
                    {{ editingCohort() ? 'Update Cohort' : 'Create Cohort' }}
                  </button>
                </div>
              </form>
            </div>
          }

          @if (cohorts().length === 0) {
            <div class="empty-state">
              <i class="fas fa-users-slash"></i>
              <h3>No Cohorts Created</h3>
              <p>Create your first cohort to start accepting applications.</p>
            </div>
          } @else {
            <div class="cohorts-grid">
              @for (cohort of cohorts(); track cohort.cohortId) {
                <div class="cohort-card">
                  <div class="cohort-header">
                    <h3>{{ cohort.number }}</h3>
                    <div [class]="'status-badge cohort-' + cohort.status">
                      {{ cohort.status | titlecase }}
                    </div>
                  </div>

                  <div class="cohort-timeline">
                    <div class="timeline-item">
                      <i class="fas fa-calendar-plus"></i>
                      <span>Applications: {{ cohort.applicationStartDate | date:'short' }} - {{ cohort.applicationEndDate | date:'short' }}</span>
                    </div>
                    <div class="timeline-item">
                      <i class="fas fa-play-circle"></i>
                      <span>Program: {{ cohort.cohortStartDate | date:'shortDate' }} - {{ cohort.cohortEndDate | date:'shortDate' }}</span>
                    </div>
                  </div>

                  <div class="cohort-actions">
                    <button class="action-button edit-button" (click)="editCohort(cohort)">
                      <i class="fas fa-edit"></i>
                      Edit
                    </button>
                    <button class="action-button delete-button" (click)="deleteCohort(cohort.cohortId)">
                      <i class="fas fa-trash"></i>
                      Delete
                    </button>
                  </div>
                </div>
              }
            </div>
          }
        </div>
      } @else {
        <div class="admin-management-view">
          <div class="view-header">
            <h2>
              <i class="fas fa-user-shield"></i>
              Admin Management
            </h2>
            <button class="primary-button" (click)="toggleAdminForm()">
              <i class="fas fa-user-plus"></i>
              Create Admin
            </button>
          </div>

          @if (success()) {
            <div class="alert alert-success">
              <i class="fas fa-check-circle"></i>
              {{ success() }}
            </div>
          }

          @if (showAdminForm()) {
            <div class="form-container">
              <form [formGroup]="adminForm" (ngSubmit)="createAdmin()" class="create-form">
                <h3>Create New Admin</h3>
                
                <div class="form-group">
                  <label for="admin-email">Email</label>
                  <input
                    type="email"
                    id="admin-email"
                    formControlName="email"
                    placeholder="admin@example.com"
                    class="form-input"
                  />
                </div>

                <div class="form-group">
                  <label for="admin-password">Password</label>
                  <input
                    type="password"
                    id="admin-password"
                    formControlName="password"
                    placeholder="Minimum 6 characters"
                    class="form-input"
                  />
                </div>

                <div class="form-actions">
                  <button type="button" class="secondary-button" (click)="toggleAdminForm()">
                    Cancel
                  </button>
                  <button type="submit" class="primary-button" [disabled]="adminForm.invalid">
                    <i class="fas fa-user-plus"></i>
                    Create Admin
                  </button>
                </div>
              </form>
            </div>
          }

          @if (admins().length === 0) {
            <div class="empty-state">
              <i class="fas fa-user-slash"></i>
              <h3>No Admins Found</h3>
              <p>Create additional admin accounts to manage the system.</p>
            </div>
          } @else {
            <div class="admins-grid">
              @for (admin of admins(); track admin.userId) {
                <div class="admin-card">
                  <div class="admin-header">
                    <div class="admin-info">
                      <h3>{{ admin.email }}</h3>
                      <p class="operator-id">
                        <i class="fas fa-id-card"></i>
                        {{ admin.operatorId }}
                      </p>
                    </div>
                  </div>
                  
                  <div class="admin-details">
                    <div class="detail-item">
                      <strong>Created:</strong> {{ admin.createdAt | date:'short' }}
                    </div>
                    @if (admin.phone) {
                      <div class="detail-item">
                        <strong>Phone:</strong> {{ admin.phone }}
                      </div>
                    }
                  </div>
                </div>
              }
            </div>
          }
        </div>
      }
    }
  </main>
</div>