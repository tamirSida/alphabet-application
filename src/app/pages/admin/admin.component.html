<div class="admin-container">
  <header class="admin-header">
    <div class="header-content">
      <div class="admin-info">
        <h1>Admin Panel</h1>
        <p>{{ authService.userData()?.email }}</p>
      </div>
      <button class="sign-out-button" (click)="signOut()">
        <i class="fas fa-sign-out-alt"></i>
        Sign Out
      </button>
    </div>
  </header>

  <nav class="admin-nav">
    <button 
      class="nav-button"
      [class.active]="currentView() === 'applications'"
      (click)="switchView('applications')">
      <i class="fas fa-file-alt"></i>
      Applications
    </button>
    <button 
      class="nav-button"
      [class.active]="currentView() === 'cohorts'"
      (click)="switchView('cohorts')">
      <i class="fas fa-users"></i>
      Cohort Management
    </button>
    <button 
      class="nav-button"
      [class.active]="currentView() === 'admin'"
      (click)="switchView('admin')">
      <i class="fas fa-user-shield"></i>
      Admin Management
    </button>
  </nav>

  <main class="admin-main">
    @if (isLoading()) {
      <div class="loading">
        <i class="fas fa-spinner fa-spin"></i>
        <p>Loading...</p>
      </div>
    } @else if (error()) {
      <div class="error-message">
        <i class="fas fa-exclamation-triangle"></i>
        <p>{{ error() }}</p>
      </div>
    } @else {
      @if (currentView() === 'applications') {
        @if (selectedApplication()) {
          <!-- Detailed Application View -->
          <div class="application-detail-view">
            <div class="detail-header">
              <button class="back-button" (click)="closeApplicationView()">
                <i class="fas fa-arrow-left"></i>
                Back to Applications
              </button>
              <h2>Application Details</h2>
            </div>

            <!-- Quick Actions - Moved to Top -->
            <div class="info-section">
              <h3>Quick Actions</h3>
              <div class="application-actions">
                
                <!-- Accept/Reject/Delete Toggles -->
                <div class="action-group">
                  @if (selectedApplication()?.status === 'accepted') {
                    <button 
                      class="action-button accept-button active"
                      (click)="acceptApplication(selectedApplication()!)">
                      <i class="fas fa-check"></i>
                      Accepted - Reassign Class
                    </button>
                  } @else {
                    <button 
                      class="action-button accept-button"
                      (click)="acceptApplication(selectedApplication()!)">
                      <i class="fas fa-check"></i>
                      Accept Application
                    </button>
                  }
                  
                  @if (selectedApplication()?.status === 'rejected') {
                    <button 
                      class="action-button reject-button active"
                      (click)="toggleReject(selectedApplication()!)">
                      <i class="fas fa-undo"></i>
                      Unreject Application
                    </button>
                  } @else {
                    <button 
                      class="action-button reject-button"
                      (click)="updateApplicationStatus(selectedApplication()!.applicationId, 'rejected')">
                      <i class="fas fa-times"></i>
                      Reject Application
                    </button>
                  }
                  
                  <button 
                    class="action-button notes-button"
                    (click)="openNotesPopup()">
                    <i class="fas fa-sticky-note"></i>
                    Notes
                  </button>
                  
                  <button 
                    class="action-button"
                    (click)="deleteApplication(selectedApplication()!.applicationId)"
                    style="background: #dc2626; color: white;">
                    <i class="fas fa-trash"></i>
                    Delete Application
                  </button>
                </div>
                
                <!-- Class Management -->
                @if (selectedApplication()?.status === 'accepted') {
                  <div class="action-group">
                    <div class="current-assignment">
                      <strong>Current Assignment:</strong> 
                      <span class="class-badge">{{ selectedApplication()?.assignedClass || 'Not assigned' }}</span>
                    </div>
                    <button 
                      class="action-button edit-button"
                      (click)="reassignClass(selectedApplication()!)">
                      <i class="fas fa-exchange-alt"></i>
                      Change Class Assignment
                    </button>
                  </div>
                }
                
                <!-- Status Info -->
                <div class="status-info">
                  <strong>Current Status:</strong> 
                  @if (selectedApplication()?.status === 'accepted' && selectedApplication()?.assignedClass) {
                    <span class="status-badge status-accepted">
                      Accepted: {{ selectedApplication()?.assignedClass }}
                    </span>
                  } @else {
                    <span [class]="'status-badge ' + getStatusClass(selectedApplication()?.status || '')">
                      {{ selectedApplication()?.status | titlecase }}
                    </span>
                  }
                  @if (selectedApplication()?.reviewedAt) {
                    <small class="review-date">
                      Reviewed: {{ selectedApplication()?.reviewedAt | date:'short' }}
                    </small>
                  }
                </div>
              </div>
            </div>
            
            <div class="applicant-info">
              <div class="info-section">
                <h3>Applicant Information</h3>
                <div class="info-grid">
                  <div class="info-item">
                    <label>Name:</label>
                    <span>{{ selectedApplication()?.formData?.personalInformation?.firstName }} {{ selectedApplication()?.formData?.personalInformation?.lastName }}</span>
                  </div>
                  <div class="info-item">
                    <label>Email:</label>
                    <span>{{ selectedApplication()?.user?.email }}</span>
                  </div>
                  <div class="info-item">
                    <label>Operator ID:</label>
                    <span>{{ selectedApplication()?.operatorId }}</span>
                  </div>
                  <div class="info-item">
                    <label>Status:</label>
                    @if (selectedApplication()?.status === 'accepted' && selectedApplication()?.assignedClass) {
                      <span class="status-badge status-accepted">
                        Accepted: {{ selectedApplication()?.assignedClass }}
                      </span>
                    } @else {
                      <span [class]="'status-badge ' + getStatusClass(selectedApplication()?.status || '')">
                        {{ selectedApplication()?.status | titlecase }}
                      </span>
                    }
                  </div>
                </div>
              </div>

              @if (selectedApplication()?.flags?.englishProficiency || selectedApplication()?.flags?.combatService) {
                <div class="flags-section alert-warning">
                  <h3><i class="fas fa-flag"></i> Red Flags</h3>
                  <div class="flags-list">
                    @if (selectedApplication()?.flags?.englishProficiency) {
                      <div class="flag-item">
                        <i class="fas fa-exclamation-triangle"></i>
                        English Proficiency: Selected "No" for IL service
                      </div>
                    }
                    @if (selectedApplication()?.flags?.combatService) {
                      <div class="flag-item">
                        <i class="fas fa-exclamation-triangle"></i>
                        Combat Service: Selected "No"
                      </div>
                    }
                  </div>
                </div>
              }

              <!-- Service & Availability Section -->
              <div class="info-section">
                <h3>Service & Availability</h3>
                <div class="info-grid">
                  <div class="info-item">
                    <label>Country of Service:</label>
                    <span>{{ selectedApplication()?.formData?.serviceAvailability?.countryOfService }}</span>
                  </div>
                  <div class="info-item">
                    <label>English Proficiency:</label>
                    <span>
                      {{ selectedApplication()?.formData?.serviceAvailability?.englishProficiency }}
                      @if (selectedApplication()?.flags?.englishProficiency) {
                        <i class="fas fa-flag flag-icon inline-flag" title="Red flag: Selected 'No' for IL service"></i>
                      }
                    </span>
                  </div>
                  <div class="info-item">
                    <label>Selected Cohort:</label>
                    <span>{{ selectedApplication()?.cohort?.number || 'Unknown' }}</span>
                  </div>
                  <div class="info-item">
                    <label>Available Classes:</label>
                    <span>{{ formatPreferredClasses(selectedApplication()!) }}</span>
                  </div>
                  @if ((selectedApplication()?.formData?.serviceAvailability?.unavailableClasses?.length || 0) > 0) {
                    <div class="info-item unavailable-classes">
                      <label>Cannot Attend:</label>
                      <div class="unavailable-list">
                        @for (unavailable of selectedApplication()?.formData?.serviceAvailability?.unavailableClasses || []; track unavailable.classId) {
                          <div class="unavailable-class">
                            <strong>{{ getClassName(unavailable.classId) }}:</strong>
                            <span>{{ unavailable.reason }}</span>
                          </div>
                        }
                      </div>
                    </div>
                  }
                </div>

                <!-- Proof of Service Files -->
                @if (selectedApplication()?.formData?.experienceBackground?.proofOfService?.length) {
                  <div class="info-item-vertical">
                    <label>Proof of Military Service:</label>
                    <div class="uploaded-files-list">
                      @for (file of selectedApplication()?.formData?.experienceBackground?.proofOfService; track $index) {
                        <div class="uploaded-file-display">
                          <i class="fas fa-file-alt"></i>
                          <a [href]="file.fileUrl" target="_blank" rel="noopener noreferrer">
                            {{ file.fileName }}
                          </a>
                          <i class="fas fa-external-link-alt"></i>
                        </div>
                      }
                    </div>
                  </div>
                } @else {
                  <div class="info-item-vertical">
                    <label>Proof of Military Service:</label>
                    <span class="long-text-content missing-data">No files uploaded</span>
                  </div>
                }
              </div>

              <!-- Experience & Background Section -->
              <div class="info-section">
                <h3>Experience & Background</h3>
                <!-- Short answer fields in grid -->
                <div class="info-grid">
                  <div class="info-item">
                    <label>Combat Service:</label>
                    <span>
                      {{ selectedApplication()?.formData?.experienceBackground?.combatService }}
                      @if (selectedApplication()?.flags?.combatService) {
                        <i class="fas fa-flag flag-icon inline-flag" title="Red flag: Selected 'No'"></i>
                      }
                    </span>
                  </div>
                  <div class="info-item">
                    <label>Has Project Idea:</label>
                    <span>{{ selectedApplication()?.formData?.experienceBackground?.hasProjectIdea }}</span>
                  </div>
                </div>
                
                <!-- Long text fields stacked vertically -->
                <div class="info-item-vertical">
                  <label>Military Service Description (75 words):</label>
                  <span class="long-text-content">{{ selectedApplication()?.formData?.experienceBackground?.militaryServiceDescription || 'Not specified' }}</span>
                </div>

                
                @if (selectedApplication()?.formData?.experienceBackground?.professionalExperience) {
                  <div class="info-item-vertical">
                    <label>Professional Experience (150 words):</label>
                    <span class="long-text-content">{{ selectedApplication()?.formData?.experienceBackground?.professionalExperience }}</span>
                  </div>
                }
              </div>
              @if (selectedApplication()?.formData?.experienceBackground?.hasProjectIdea === 'Yes' && selectedApplication()?.formData?.experienceBackground?.projectIdea) {
                <div class="info-section">
                  <h3>Project Idea Details</h3>
                  <div class="info-item-vertical">
                    <label>Project Description (200 words):</label>
                    <span class="long-text-content">{{ selectedApplication()?.formData?.experienceBackground?.projectIdea?.description }}</span>
                  </div>
                </div>
              }

              <!-- Skills Assessment Section -->
              <div class="info-section">
                <h3>Skills Assessment (1-5 Scale)
                  @if (selectedApplication()?.formData?.skills) {
                    <span class="score-badge">
                      {{ calculateSkillsScore(selectedApplication()?.formData?.skills).score }}/{{ calculateSkillsScore(selectedApplication()?.formData?.skills).maxScore }} 
                      ({{ calculateSkillsScore(selectedApplication()?.formData?.skills).percentage }}%)
                    </span>
                  }
                </h3>
                <div class="info-grid">
                  <div class="info-item">
                    <label>AI Daily Use:</label>
                    <span>{{ selectedApplication()?.formData?.skills?.aiDailyUse }}/5</span>
                  </div>
                  <div class="info-item">
                    <label>Programming:</label>
                    <span>{{ selectedApplication()?.formData?.skills?.programming }}/5</span>
                  </div>
                  <div class="info-item">
                    <label>Product Marketing & Sales Experience:</label>
                    <span>{{ selectedApplication()?.formData?.skills?.marketingSales }}/5</span>
                  </div>
                  <div class="info-item">
                    <label>Leadership Experience:</label>
                    <span>{{ selectedApplication()?.formData?.skills?.management }}/5</span>
                  </div>
                  <div class="info-item">
                    <label>Public Speaking & Presentation Skills:</label>
                    <span>{{ selectedApplication()?.formData?.skills?.publicSpeaking }}/5</span>
                  </div>
                  @if (selectedApplication()?.formData?.skills?.other) {
                    <div class="info-item">
                      <label>{{ selectedApplication()?.formData?.skills?.other?.skill }}:</label>
                      <span>{{ selectedApplication()?.formData?.skills?.other?.rating }}/5</span>
                    </div>
                  }
                </div>
              </div>

              <!-- Personal Qualities Section -->
              <div class="info-section">
                <h3>Personal Qualities (0-10 Scale)
                  @if (selectedApplication()?.formData?.personalQualities) {
                    <span class="score-badge">
                      {{ calculatePersonalQualitiesScore(selectedApplication()?.formData?.personalQualities).score }}/{{ calculatePersonalQualitiesScore(selectedApplication()?.formData?.personalQualities).maxScore }} 
                      ({{ calculatePersonalQualitiesScore(selectedApplication()?.formData?.personalQualities).percentage }}%)
                    </span>
                  }
                </h3>
                
                <div class="info-item-vertical">
                  <label>Proactive Personality: {{ selectedApplication()?.formData?.personalQualities?.proactivePersonality?.rating }}/10</label>
                  <span class="quality-example">{{ selectedApplication()?.formData?.personalQualities?.proactivePersonality?.example }}</span>
                </div>
                
                <div class="info-item-vertical">
                  <label>Persistence & Handle Difficulties: {{ selectedApplication()?.formData?.personalQualities?.persistenceHandleDifficulties?.rating }}/10</label>
                  <span class="quality-example">{{ selectedApplication()?.formData?.personalQualities?.persistenceHandleDifficulties?.example }}</span>
                </div>
                
                <div class="info-item-vertical">
                  <label>Perform Under Stress: {{ selectedApplication()?.formData?.personalQualities?.performUnderStress?.rating }}/10</label>
                  <span class="quality-example">{{ selectedApplication()?.formData?.personalQualities?.performUnderStress?.example }}</span>
                </div>
                
                <div class="info-item-vertical">
                  <label>Independence: {{ selectedApplication()?.formData?.personalQualities?.independence?.rating }}/10</label>
                  <span class="quality-example">{{ selectedApplication()?.formData?.personalQualities?.independence?.example }}</span>
                </div>
                
                <div class="info-item-vertical">
                  <label>Teamwork: {{ selectedApplication()?.formData?.personalQualities?.teamwork?.rating }}/10</label>
                  <span class="quality-example">{{ selectedApplication()?.formData?.personalQualities?.teamwork?.example }}</span>
                </div>
                
                <div class="info-item-vertical">
                  <label>Mental Flexibility: {{ selectedApplication()?.formData?.personalQualities?.mentalFlexibility?.rating }}/10</label>
                  <span class="quality-example">{{ selectedApplication()?.formData?.personalQualities?.mentalFlexibility?.example }}</span>
                </div>
                
                <div class="info-item-vertical">
                  <label>Passion for Projects: {{ selectedApplication()?.formData?.personalQualities?.passionForProjects?.rating }}/10</label>
                  <span class="quality-example">{{ selectedApplication()?.formData?.personalQualities?.passionForProjects?.example }}</span>
                </div>
                
                <div class="info-item-vertical">
                  <label>Creative Thinking: {{ selectedApplication()?.formData?.personalQualities?.creativeThinking?.rating }}/10</label>
                  <span class="quality-example">{{ selectedApplication()?.formData?.personalQualities?.creativeThinking?.example }}</span>
                </div>
              </div>

              <!-- Short Answer Section -->
              @if (selectedApplication()?.formData?.shortAnswer?.failureDescription) {
                <div class="info-section">
                  <h3>Short Answer</h3>
                  <div class="info-item-vertical">
                    <label>Describe a failure and what you learned (200 words):</label>
                    <span class="long-text-content">{{ selectedApplication()?.formData?.shortAnswer?.failureDescription }}</span>
                  </div>
                </div>
              }

              <!-- Additional Information Section -->
              @if (selectedApplication()?.formData?.coverLetter?.content) {
                <div class="info-section">
                  <h3>Additional Information</h3>
                  <div class="info-item-vertical">
                    <label>Tell us anything else (300 words):</label>
                    <span class="long-text-content">{{ selectedApplication()?.formData?.coverLetter?.content }}</span>
                  </div>
                </div>
              }

              <!-- Video Introduction Section -->
              @if (selectedApplication()?.formData?.videoIntroduction?.videoUrl) {
                <div class="info-section">
                  <h3>Video Introduction</h3>
                  <div class="info-item">
                    <label>Video URL:</label>
                    <span>
                      <a [href]="selectedApplication()?.formData?.videoIntroduction?.videoUrl" target="_blank" rel="noopener noreferrer">
                        {{ selectedApplication()?.formData?.videoIntroduction?.videoUrl }}
                      </a>
                    </span>
                  </div>
                </div>
              }

              <!-- Friends Section -->
              @if (selectedApplication()?.formData?.friends?.friend1StudentId || selectedApplication()?.formData?.friends?.friend2StudentId) {
                <div class="info-section">
                  <h3>Friends in Program</h3>
                  <div class="info-grid">
                    @if (selectedApplication()?.formData?.friends?.friend1StudentId) {
                      <div class="info-item">
                        <label>Friend 1:</label>
                        <span>{{ selectedApplication()?.formData?.friends?.friend1StudentId }}</span>
                      </div>
                    }
                    @if (selectedApplication()?.formData?.friends?.friend2StudentId) {
                      <div class="info-item">
                        <label>Friend 2:</label>
                        <span>{{ selectedApplication()?.formData?.friends?.friend2StudentId }}</span>
                      </div>
                    }
                  </div>
                </div>
              }

              <!-- Notes Section -->
              @if (selectedApplication()?.notes) {
                <div class="info-section notes-display">
                  <h3>Notes</h3>
                  <div class="info-item-vertical">
                    <div class="notes-header">
                      <span class="notes-author">{{ selectedApplication()?.notes?.adminEmail }}</span>
                      <span class="notes-timestamp">
                        @if (selectedApplication()?.notes?.updatedAt !== selectedApplication()?.notes?.createdAt) {
                          Updated {{ formatTimestamp(selectedApplication()?.notes?.updatedAt) }}
                        } @else {
                          Created {{ formatTimestamp(selectedApplication()?.notes?.createdAt) }}
                        }
                      </span>
                    </div>
                    <span class="admin-notes-content">{{ selectedApplication()?.notes?.content }}</span>
                  </div>
                </div>
              }

            </div>
          </div>
        } @else {
          <!-- Applications Table View -->
          <div class="applications-view">
            <div class="view-header">
              <h2>
                <i class="fas fa-file-alt"></i>
                Applications Management
              </h2>
              <div class="stats">
                <span class="stat-item">
                  Total: {{ applications().length }}
                </span>
                <span class="stat-item">
                  Filtered: {{ filteredApplications().length }}
                </span>
                @if (canPublishResults() && !isPublishing()) {
                  <button 
                    class="primary-button"
                    (click)="publishResults()"
                    style="background: #059669; color: white;">
                    <i class="fas fa-paper-plane"></i>
                    Publish Results to All Applicants
                  </button>
                } @else if (isPublishing()) {
                  <button 
                    class="primary-button"
                    disabled
                    style="background: #6b7280; color: white; cursor: not-allowed;">
                    <i class="fas fa-spinner fa-spin"></i>
                    Publishing Results...
                  </button>
                } @else if (applications().length > 0) {
                  <span class="stat-item" style="background: #fbbf24; color: #92400e;">
                    ⚠️ All applications must be accepted or rejected to publish
                  </span>
                }
              </div>

              <!-- Publish Status Indicator -->
              @if (lastPublishTime()) {
                <div class="publish-status-indicator">
                  <i class="fas fa-check-circle"></i>
                  <span>Results last published {{ getLastPublishDisplay() }}</span>
                </div>
              }
            </div>

            <!-- Search and Filter Controls -->
            <div class="table-controls">
              <div class="search-box">
                <i class="fas fa-search"></i>
                <input 
                  type="text" 
                  placeholder="Search by name, email, or ID..."
                  [value]="searchTerm()"
                  (input)="updateSearch($any($event.target).value)">
              </div>
              
              <div class="filter-controls">
                <select [value]="statusFilter()" (change)="updateStatusFilter($any($event.target).value)">
                  <option value="all">All Statuses</option>
                  <option value="submitted">Submitted</option>
                  <option value="under_review">Under Review</option>
                  <option value="accepted">Accepted</option>
                  <option value="rejected">Rejected</option>
                </select>
                
                <select [value]="countryFilter()" (change)="updateCountryFilter($any($event.target).value)">
                  <option value="all">All Countries</option>
                  <option value="US">US</option>
                  <option value="IL">IL</option>
                </select>
                
                <select [value]="classFilter()" (change)="updateClassFilter($any($event.target).value)">
                  <option value="all">All Classes</option>
                  @for (classOption of availableClasses(); track classOption) {
                    <option [value]="classOption">{{ classOption }}</option>
                  }
                </select>
              </div>
            </div>

            @if (filteredApplications().length === 0) {
              <div class="empty-state">
                <i class="fas fa-inbox"></i>
                <h3>No Applications Found</h3>
                <p>No applications match your current search and filter criteria.</p>
              </div>
            } @else {
              <!-- Applications Table -->
              <div class="table-container">
                <table class="applications-table">
                  <thead>
                    <tr>
                      <th>Name</th>
                      <th>Email</th>
                      <th>ID</th>
                      <th>Country</th>
                      <th>Preferred Class</th>
                      <th>Assigned Class</th>
                      <th>Status</th>
                      <th>Submitted</th>
                      <th>Flags</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    @for (application of filteredApplications(); track application.applicationId) {
                      <tr class="table-row" [class.has-flags]="application.flags.englishProficiency || application.flags.combatService">
                        <td>
                          <div class="name-cell">
                            {{ application.formData.personalInformation.firstName || '' }} 
                            {{ application.formData.personalInformation.lastName || '' }}
                          </div>
                        </td>
                        <td>
                          <div class="email-cell">
                            {{ application.user?.email || 'Unknown' }}
                          </div>
                        </td>
                        <td>
                          <div class="id-cell">
                            {{ application.operatorId }}
                          </div>
                        </td>
                        <td>
                          <div class="country-cell">
                            {{ application.formData.serviceAvailability.countryOfService }}
                          </div>
                        </td>
                        <td>
                          <div class="preferred-class-cell">
                            {{ formatPreferredClasses(application) }}
                          </div>
                        </td>
                        <td>
                          <div class="assigned-class-cell">
                            {{ application.assignedClass || '-' }}
                          </div>
                        </td>
                        <td>
                          @if (application.status === 'accepted' && application.assignedClass) {
                            <span class="status-badge table-status status-accepted">
                              {{ application.assignedClass }}
                            </span>
                          } @else {
                            <span [class]="'status-badge table-status ' + getStatusClass(application.status)">
                              {{ application.status | titlecase }}
                            </span>
                          }
                        </td>
                        <td>
                          <div class="date-cell">
                            {{ application.submittedAt | date:'M/d/yy' }}
                          </div>
                        </td>
                        <td>
                          <div class="flags-cell">
                            @if (application.flags.englishProficiency || application.flags.combatService) {
                              <i class="fas fa-flag flag-icon" title="Has red flags"></i>
                            }
                          </div>
                        </td>
                        <td>
                          <div class="actions-cell">
                            <button 
                              class="table-action-btn view-btn"
                              (click)="viewApplication(application)"
                              title="View Details">
                              <i class="fas fa-eye"></i>
                            </button>
                            
                            <!-- Accept/Reject Toggle -->
                            @if (application.status === 'accepted') {
                              <button 
                                class="table-action-btn accept-btn active"
                                (click)="acceptApplication(application)"
                                title="Accepted - Click to reassign class">
                                <i class="fas fa-check"></i>
                              </button>
                            } @else {
                              <button 
                                class="table-action-btn accept-btn"
                                (click)="acceptApplication(application)"
                                title="Accept">
                                <i class="fas fa-check"></i>
                              </button>
                            }
                            
                            @if (application.status === 'rejected') {
                              <button 
                                class="table-action-btn reject-btn active"
                                (click)="toggleReject(application)"
                                title="Rejected - Click to unreject">
                                <i class="fas fa-times"></i>
                              </button>
                            } @else {
                              <button 
                                class="table-action-btn reject-btn"
                                (click)="updateApplicationStatus(application.applicationId, 'rejected')"
                                title="Reject">
                                <i class="fas fa-times"></i>
                              </button>
                            }
                            
                            <!-- Quick Class Assignment for Accepted Applications -->
                            @if (application.status === 'accepted' && application.assignedClass) {
                              <button 
                                class="table-action-btn class-btn"
                                (click)="reassignClass(application)"
                                title="Currently assigned to {{ application.assignedClass }} - Click to reassign">
                                <i class="fas fa-users"></i>
                                <small>{{ application.assignedClass }}</small>
                              </button>
                            }
                            
                            <!-- Delete Button -->
                            <button 
                              class="table-action-btn"
                              (click)="deleteApplication(application.applicationId)"
                              title="Delete Application"
                              style="background: #dc2626; color: white;">
                              <i class="fas fa-trash"></i>
                            </button>
                          </div>
                        </td>
                      </tr>
                    }
                  </tbody>
                </table>
              </div>
            }
          </div>
        }
      } @else if (currentView() === 'cohorts') {
        <div class="cohorts-view">
          <div class="view-header">
            <h2>
              <i class="fas fa-users"></i>
              Cohort Management
            </h2>
            <button class="primary-button" (click)="toggleCohortForm()">
              <i class="fas fa-plus"></i>
              Create Cohort
            </button>
          </div>

          @if (success()) {
            <div class="alert alert-success">
              <i class="fas fa-check-circle"></i>
              {{ success() }}
            </div>
          }

          @if (showCohortForm()) {
            <div class="form-container">
              <form [formGroup]="cohortForm" (ngSubmit)="createCohort()" class="create-form">
                <h3>{{ editingCohort() ? 'Edit Cohort' : 'Create New Cohort' }}</h3>
                
                <div class="form-group">
                  <label for="cohort-number">Cohort Number</label>
                  <input
                    type="text"
                    id="cohort-number"
                    formControlName="number"
                    placeholder="e.g., Cohort 1"
                    class="form-input"
                  />
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label for="app-start">Application Start Date</label>
                    <input
                      type="date"
                      id="app-start"
                      formControlName="applicationStartDate"
                      class="form-input"
                    />
                  </div>
                  <div class="form-group">
                    <label for="app-start-time">Start Time</label>
                    <input
                      type="time"
                      id="app-start-time"
                      formControlName="applicationStartTime"
                      class="form-input"
                    />
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label for="app-end">Application End Date</label>
                    <input
                      type="date"
                      id="app-end"
                      formControlName="applicationEndDate"
                      class="form-input"
                    />
                  </div>
                  <div class="form-group">
                    <label for="app-end-time">End Time</label>
                    <input
                      type="time"
                      id="app-end-time"
                      formControlName="applicationEndTime"
                      class="form-input"
                    />
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label for="cohort-start">Cohort Start Date</label>
                    <input
                      type="date"
                      id="cohort-start"
                      formControlName="cohortStartDate"
                      class="form-input"
                    />
                  </div>
                  <div class="form-group">
                    <label for="cohort-end">Cohort End Date</label>
                    <input
                      type="date"
                      id="cohort-end"
                      formControlName="cohortEndDate"
                      class="form-input"
                    />
                  </div>
                </div>

                <!-- Classes Section -->
                <div class="classes-section">
                  <div class="classes-header">
                    <h3>Classes Configuration</h3>
                    <button type="button" class="add-class-button" (click)="addNewClass()">
                      <i class="fas fa-plus"></i>
                      Add Class
                    </button>
                  </div>

                  <div formArrayName="classes" class="classes-list">
                    @for (classControl of classesArray.controls; track classIndex; let classIndex = $index) {
                      <div [formGroupName]="classIndex" class="class-item">
                        <div class="class-header">
                          <div class="class-basic-info">
                            <div class="form-group">
                              <label>Class Name</label>
                              <input
                                type="text"
                                formControlName="name"
                                class="form-input class-name-input"
                                placeholder="e.g., Class A">
                            </div>
                            <div class="form-group">
                              <label>Capacity</label>
                              <input
                                type="number"
                                formControlName="capacity"
                                class="form-input capacity-input"
                                min="1"
                                placeholder="25">
                            </div>
                          </div>
                          
                          @if (classesArray.length > 1) {
                            <button 
                              type="button" 
                              class="remove-class-button"
                              (click)="removeClass(classIndex)">
                              <i class="fas fa-trash"></i>
                            </button>
                          }
                        </div>

                        <!-- Weekdays Selection -->
                        <div class="weekdays-section">
                          <label class="section-label">Select Weekdays</label>
                          <div class="weekdays-grid" formGroupName="weekdays">
                            @for (day of ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday']; track day) {
                              <div class="weekday-item">
                                <input 
                                  type="checkbox"
                                  [id]="'weekday-' + classIndex + '-' + day"
                                  [formControlName]="day"
                                  (change)="onWeekdayChange(classIndex, day, $any($event.target).checked)">
                                <label [for]="'weekday-' + classIndex + '-' + day" class="weekday-label">
                                  {{ day.substring(0, 3) }}
                                </label>
                              </div>
                            }
                          </div>
                        </div>

                        <!-- Times for Selected Days -->
                        <div class="times-section" formGroupName="times">
                          <label class="section-label">Class Times</label>
                          <div class="times-grid">
                            @for (day of getSelectedWeekdays(classIndex); track day) {
                              <div class="time-row" [formGroupName]="day">
                                <div class="day-name">{{ day }}</div>
                                <div class="time-inputs">
                                  <input
                                    type="time"
                                    formControlName="startTime"
                                    class="form-input time-input">
                                  <span class="time-separator">to</span>
                                  <input
                                    type="time"
                                    formControlName="endTime"
                                    class="form-input time-input">
                                </div>
                              </div>
                            }
                          </div>
                          
                          @if (getSelectedWeekdays(classIndex).length === 0) {
                            <div class="no-days-selected">
                              <i class="fas fa-info-circle"></i>
                              Select weekdays above to set class times
                            </div>
                          }
                        </div>
                      </div>
                    }
                  </div>

                  @if (classesArray.length === 0) {
                    <div class="no-classes">
                      <i class="fas fa-plus-circle"></i>
                      <p>Add at least one class to continue</p>
                    </div>
                  }
                </div>

                <!-- Lab Section -->
                <div class="lab-section">
                  <div class="lab-header">
                    <h3>Lab Configuration</h3>
                    <span class="lab-subtitle">One lab session shared by all classes</span>
                  </div>

                  <div formGroupName="lab" class="lab-item">
                    <!-- Weekdays Selection for Lab -->
                    <div class="weekdays-section">
                      <label class="section-label">Select Lab Weekdays</label>
                      <div class="weekdays-grid" formGroupName="weekdays">
                        @for (day of ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday']; track day) {
                          <div class="weekday-item">
                            <input 
                              type="checkbox"
                              [id]="'lab-weekday-' + day"
                              [formControlName]="day"
                              (change)="onLabWeekdayChange(day, $any($event.target).checked)">
                            <label [for]="'lab-weekday-' + day" class="weekday-label">
                              {{ day.substring(0, 3) }}
                            </label>
                          </div>
                        }
                      </div>
                    </div>

                    <!-- Times for Selected Days -->
                    <div class="times-section" formGroupName="times">
                      <label class="section-label">Lab Times</label>
                      <div class="times-grid">
                        @for (day of getSelectedLabWeekdays(); track day) {
                          <div class="time-row" [formGroupName]="day">
                            <div class="day-name">{{ day }}</div>
                            <div class="time-inputs">
                              <input
                                type="time"
                                formControlName="startTime"
                                class="form-input time-input">
                              <span class="time-separator">to</span>
                              <input
                                type="time"
                                formControlName="endTime"
                                class="form-input time-input">
                            </div>
                          </div>
                        }
                      </div>
                      
                      @if (getSelectedLabWeekdays().length === 0) {
                        <div class="no-days-selected">
                          <i class="fas fa-info-circle"></i>
                          Select weekdays above to set lab times
                        </div>
                      }
                    </div>
                  </div>
                </div>

                <div class="form-actions">
                  <button type="button" class="secondary-button" (click)="toggleCohortForm()">
                    Cancel
                  </button>
                  <button type="submit" class="primary-button" [disabled]="cohortForm.invalid">
                    <i class="fas {{ editingCohort() ? 'fa-save' : 'fa-plus' }}"></i>
                    {{ editingCohort() ? 'Update Cohort' : 'Create Cohort' }}
                  </button>
                </div>
              </form>
            </div>
          }

          @if (cohorts().length === 0) {
            <div class="empty-state">
              <i class="fas fa-users-slash"></i>
              <h3>No Cohorts Created</h3>
              <p>Create your first cohort to start accepting applications.</p>
            </div>
          } @else {
            <div class="cohorts-grid">
              @for (cohort of cohorts(); track cohort.cohortId) {
                <div class="cohort-card">
                  <div class="cohort-header">
                    <h3>{{ cohort.number }}</h3>
                    <div [class]="'status-badge cohort-' + cohort.status">
                      {{ formatCohortStatus(cohort.status) }}
                    </div>
                  </div>

                  <div class="cohort-timeline">
                    <div class="timeline-item">
                      <i class="fas fa-calendar-plus"></i>
                      <span>Applications: {{ cohort.applicationStartDate | date:'short' }} - {{ cohort.applicationEndDate | date:'short' }}</span>
                    </div>
                    <div class="timeline-item">
                      <i class="fas fa-play-circle"></i>
                      <span>Program: {{ cohort.cohortStartDate | date:'shortDate' }} - {{ cohort.cohortEndDate | date:'shortDate' }}</span>
                    </div>
                  </div>

                  <div class="cohort-actions">
                    <button class="action-button edit-button" (click)="editCohort(cohort)">
                      <i class="fas fa-edit"></i>
                      Edit
                    </button>
                    <button class="action-button delete-button" (click)="deleteCohort(cohort.cohortId)">
                      <i class="fas fa-trash"></i>
                      Delete
                    </button>
                  </div>
                </div>
              }
            </div>
          }
        </div>
      } @else {
        <div class="admin-management-view">
          <div class="view-header">
            <h2>
              <i class="fas fa-user-shield"></i>
              Admin Management
            </h2>
            <button class="primary-button" (click)="toggleAdminForm()">
              <i class="fas fa-user-plus"></i>
              Create Admin
            </button>
          </div>

          @if (success()) {
            <div class="alert alert-success">
              <i class="fas fa-check-circle"></i>
              {{ success() }}
            </div>
          }

          @if (showAdminForm()) {
            <div class="form-container">
              <form [formGroup]="adminForm" (ngSubmit)="createAdmin()" class="create-form">
                <h3>Create New Admin</h3>
                
                <div class="form-group">
                  <label for="admin-email">Email</label>
                  <input
                    type="email"
                    id="admin-email"
                    formControlName="email"
                    placeholder="admin@example.com"
                    class="form-input"
                  />
                </div>

                <div class="form-group">
                  <label for="admin-password">Password</label>
                  <input
                    type="password"
                    id="admin-password"
                    formControlName="password"
                    placeholder="Minimum 6 characters"
                    class="form-input"
                  />
                </div>

                <div class="form-actions">
                  <button type="button" class="secondary-button" (click)="toggleAdminForm()">
                    Cancel
                  </button>
                  <button type="submit" class="primary-button" [disabled]="adminForm.invalid">
                    <i class="fas fa-user-plus"></i>
                    Create Admin
                  </button>
                </div>
              </form>
            </div>
          }

          @if (admins().length === 0) {
            <div class="empty-state">
              <i class="fas fa-user-slash"></i>
              <h3>No Admins Found</h3>
              <p>Create additional admin accounts to manage the system.</p>
            </div>
          } @else {
            <div class="admins-grid">
              @for (admin of admins(); track admin.userId) {
                <div class="admin-card">
                  <div class="admin-header">
                    <div class="admin-info">
                      <h3>{{ admin.email }}</h3>
                      <p class="operator-id">
                        <i class="fas fa-id-card"></i>
                        {{ admin.operatorId }}
                      </p>
                    </div>
                  </div>
                  
                  <div class="admin-details">
                    <div class="detail-item">
                      <strong>Created:</strong> {{ admin.createdAt | date:'short' }}
                    </div>
                    @if (admin.phone) {
                      <div class="detail-item">
                        <strong>Phone:</strong> {{ admin.phone }}
                      </div>
                    }
                  </div>
                </div>
              }
            </div>
          }
        </div>
      }
    }
  </main>

  <!-- Class Selection Modal -->
  @if (showClassSelectionModal()) {
    <div class="modal-overlay" (click)="closeClassSelectionModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3>{{ classSelectionModalTitle() }}</h3>
          <button class="close-btn" (click)="closeClassSelectionModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>
        
        <div class="modal-body">
          <p>{{ classSelectionModalSubtitle() }}</p>
          
          <div class="class-selection-grid">
            @for (className of availableClasses(); track className) {
              <button 
                class="class-option-btn"
                [class.current-class]="className === pendingApplication()?.assignedClass"
                (click)="selectClass(className)">
                <i class="fas fa-users"></i>
                <span>{{ className }}</span>
                @if (className === pendingApplication()?.assignedClass) {
                  <small>Current</small>
                }
              </button>
            }
          </div>
        </div>
        
        <div class="modal-footer">
          <button class="secondary-button" (click)="closeClassSelectionModal()">
            Cancel
          </button>
        </div>
      </div>
    </div>
  }

  <!-- Notes Floating Popup -->
  @if (showNotesPopup()) {
    <div class="notes-popup-window" 
         [style.left.px]="notesPosition().x"
         [style.top.px]="notesPosition().y"
         [class.dragging]="isDragging()">
      <div class="popup-header" (mousedown)="onMouseDown($event)">
        <div class="popup-title">
          <i class="fas fa-sticky-note"></i>
          <span>Notes - {{ selectedApplication()?.formData?.personalInformation?.firstName }} {{ selectedApplication()?.formData?.personalInformation?.lastName }}</span>
        </div>
        <div class="popup-controls">
          <button class="popup-minimize-btn" title="Minimize">
            <i class="fas fa-minus"></i>
          </button>
          <button class="popup-close-btn" (click)="closeNotesPopup()" title="Close">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>
      
      <div class="popup-body">
        @if (selectedApplication()?.notes?.adminEmail) {
          <div class="current-notes-info">
            <small>By: {{ selectedApplication()?.notes?.adminEmail }} • {{ formatTimestamp(selectedApplication()?.notes?.updatedAt) }}</small>
          </div>
        }
        
        <textarea 
          class="popup-notes-textarea"
          rows="12"
          placeholder="Add your review notes here..."
          [value]="notesContent()"
          (input)="notesContent.set($any($event.target).value)"
          [disabled]="isSavingNotes()"></textarea>
      </div>
      
      <div class="popup-footer">
        <button 
          class="popup-cancel-btn" 
          (click)="closeNotesPopup()"
          [disabled]="isSavingNotes()">
          Cancel
        </button>
        <button 
          class="popup-save-btn"
          (click)="saveNotes()"
          [disabled]="isSavingNotes()">
          @if (isSavingNotes()) {
            <i class="fas fa-spinner fa-spin"></i>
            Saving...
          } @else {
            <i class="fas fa-save"></i>
            Save
          }
        </button>
      </div>
    </div>
  }
</div>